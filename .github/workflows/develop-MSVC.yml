name: WinUSB installer Build, Test

on:
  push:
    branches:
          - 'features/2-cdci-create-gitlab-workflow' #'*'  # This will run the build and test jobs for pull requests to all branches
     

  # pull_request:
  #   branches:
  #     - '*'  # This will run the build and test jobs for pull requests to all branches

env:
  WDK_8_PKG_URL: "https://go.microsoft.com/fwlink/p/?LinkID=253170"
  USB_DRIVER_INSTALLER: "https://github.com/pbatard/libwdi/releases/download/v1.5.0/zadig-2.8.exe"
jobs:
  release:
    runs-on: windows-latest
    
    steps:
      - name: Download USB driver and install component
        run: |
          Invoke-WebRequest -Uri ${{ env.USB_DRIVER_INSTALLER }} -OutFile zadig-2.8.exe
          zadig-2.8.exe

      - name: Checkout repository and submodules
        uses: actions/checkout@v2
        with:
          submodules: recursive

      - name: Create and enter the build directory
        run: |
          mkdir build
          cd build

      - name: Download WDK 8 and install component
        run: |
          Invoke-WebRequest -Uri ${{ env.WDK_8_PKG_URL }} -OutFile wdfcoinstaller.msi
          msiexec /i wdfcoinstaller.msi /qn /l*v install.log

